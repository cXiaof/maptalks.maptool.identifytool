/*!
 * maptalks.maptool.identifytool v0.1.0-alpha.1
 * LICENSE : MIT
 * (c) 2016-2022 maptalks.org
 */
/*!
 * requires maptalks@>=1.0.0-rc.1 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,o){"use strict";function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);if(t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e)if(Object.setPrototypeOf)Object.setPrototypeOf(t,e);else for(var i=t,n=e,o=Object.getOwnPropertyNames(n),r=0;r<o.length;r++){var a=o[r],s=Object.getOwnPropertyDescriptor(n,a);s&&s.configurable&&void 0===i[a]&&Object.defineProperty(i,a,s)}}var i,n=o.INTERNAL_LAYER_PREFIX+"_identify_map_tool",r="#2b81ff",a={markerType:"pin",markerFill:r,markerLineColor:"#fff",markerLineWidth:2,markerWidth:48,markerHeight:40},s={lineColor:r,lineWidth:2,polygonFill:r,polygonOpacity:.15},l={markerType:"ellipse",markerFill:r,markerLineColor:"#fff",markerLineWidth:2,markerLineOpacity:1,markerWidth:12,markerHeight:12},c={lineColor:r,lineWidth:2,textPlacement:"line",textName:"{value}",textSize:16,textFill:r,textHaloFill:"#fff",textHaloRadius:2,textDy:16},r=(e(p,i=o.MapTool),p.prototype.onAdd=function(){this._map=this.getMap()},p.prototype.onEnable=function(){this._initLayer(),this._initRange(),this._initDistance(),this._initCenterPoint(),this._initDistancePoint()},p.prototype.getEvents=function(){return{}},p.prototype.onDisable=function(){this._layer&&this._layer.remove()},p.prototype.submit=function(){console.log("submit")},p.prototype.setCenter=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._map.getCenter(),e=(t instanceof o.Coordinate||(t=new o.Coordinate(t)),this._centerP.getCoordinates()),i=t.x-e.x,n=t.y-e.y;this._layer.forEach(function(t){return t.translate(i,n)}),this.options.autoSubmit&&this.submit()},p.prototype.setRadius=function(){this._range.setRadius(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3);var t=this._range.getShell()[0];this._handleDrag({coordinate:t}),this.options.autoSubmit&&this.submit()},p.prototype._initLayer=function(){this._layer=new o.VectorLayer(n).addTo(this._map)},p.prototype._initRange=function(){var t=this._map.getCenter();this._range=new o.Circle(t,1e3,{symbol:s,numberOfShellPoints:720}),this._range.addTo(this._layer)},p.prototype._initDistance=function(){var e=this,t=this._map.getCenter(),i=this._range.getShell()[0];this._distance=new o.LineString([t,i],{symbol:c,properties:{value:this._calcDistance(1e3)}}),this._distance.on("shapechange",function(){var t=e._distance.getLength();e._range.setRadius(t),e._distance.setProperties({value:e._calcDistance(t)}),e._distance.setSymbol(c)}),this._distance.addTo(this._layer)},p.prototype._calcDistance=function(t){return t<=1e3?t.toFixed(t%1==0?0:1)+"m":(t/=1e3).toFixed(2)+"km"},p.prototype._initCenterPoint=function(){var t=this._map.getCenter();this._centerP=new o.Marker(t,{symbol:a}),this._centerP.addTo(this._layer)},p.prototype._initDistancePoint=function(){var t=this._range.getShell()[0];this._distP=new o.Marker(t,{symbol:l,properties:{value:this._distance.getLength()},draggable:!0}),this._distP.on("dragging",this._handleDrag.bind(this)),this._distP.on("dragend",this._handleDrag.bind(this)),this._distP.addTo(this._layer)},p.prototype._handleDrag=function(t){this._distance.setCoordinates([this._centerP.getCenter(),t.coordinate]),this._distP.setCoordinates(this._distance.getLastCoordinate())},p);function p(t){if(!(this instanceof p))throw new TypeError("Cannot call a class as a function");var e=this,t=i.call(this,t);if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}r.mergeOptions({autoSubmit:!0,layers:[],filter:null,count:null,includeInternals:!1,includeInvisible:!1}),t.IdentifyTool=r,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.maptool.identifytool v0.1.0-alpha.1, requires maptalks@>=1.0.0-rc.1.")});