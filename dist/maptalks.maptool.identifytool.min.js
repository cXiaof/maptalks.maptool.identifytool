/*!
 * maptalks.maptool.identifytool v0.1.0-alpha.1
 * LICENSE : MIT
 * (c) 2016-2022 maptalks.org
 */
/*!
 * requires maptalks@>=1.0.0-rc.1 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,n){"use strict";function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t)if(Object.setPrototypeOf)Object.setPrototypeOf(e,t);else for(var i=e,n=t,o=Object.getOwnPropertyNames(n),r=0;r<o.length;r++){var a=o[r],s=Object.getOwnPropertyDescriptor(n,a);s&&s.configurable&&void 0===i[a]&&Object.defineProperty(i,a,s)}}var i,o=n.INTERNAL_LAYER_PREFIX+"_identify_map_tool",r="#2b81ff",a={markerType:"pin",markerFill:r,markerLineColor:"#fff",markerLineWidth:2,markerWidth:48,markerHeight:40},s={lineColor:r,lineWidth:2,polygonFill:r,polygonOpacity:.15},l={markerType:"ellipse",markerFill:r,markerLineColor:"#fff",markerLineWidth:2,markerLineOpacity:1,markerWidth:12,markerHeight:12},p={lineColor:r,lineWidth:2,textPlacement:"line",textName:"{value}",textSize:16,textFill:r,textHaloFill:"#fff",textHaloRadius:2,textDy:16},r=(t(c,i=n.MapTool),c.prototype.onAdd=function(){this._map=this.getMap()},c.prototype.onEnable=function(){this._initLayer(),this._initRange(),this._initDistance(),this._initCenterPoint(),this._initDistancePoint()},c.prototype.getEvents=function(){return{}},c.prototype.onDisable=function(){this._layer&&this._layer.remove()},c.prototype._initLayer=function(){this._layer=new n.VectorLayer(o).addTo(this._map)},c.prototype._initRange=function(){var e=this._map.getCenter();this._range=new n.Circle(e,this.options.radiusDefault,{symbol:s,numberOfShellPoints:720}),this._range.addTo(this._layer)},c.prototype._initDistance=function(){var t=this,e=this._map.getCenter(),i=this._range.getShell()[0];this._distance=new n.LineString([e,i],{symbol:p,properties:{value:this._calcDistance(this.options.radiusDefault)}}),this._distance.on("shapechange",function(){var e=t._distance.getLength();t._range.setRadius(e),t._distance.setProperties({value:t._calcDistance(e)}),t._distance.setSymbol(p)}),this._distance.addTo(this._layer)},c.prototype._calcDistance=function(e){return e<=1e3?e.toFixed(e%1==0?0:1)+"m":(e/=1e3).toFixed(2)+"km"},c.prototype._initCenterPoint=function(){var e=this._map.getCenter();this._centerP=new n.Marker(e,{symbol:a}),this._centerP.addTo(this._layer)},c.prototype._initDistancePoint=function(){var e=this._range.getShell()[0];this._distP=new n.Marker(e,{symbol:l,properties:{value:this._distance.getLength()},draggable:!0}),this._distP.on("dragging",this._handleDrag.bind(this)),this._distP.on("dragend",this._handleDrag.bind(this)),this._distP.addTo(this._layer)},c.prototype._handleDrag=function(e){this._distance.setCoordinates([this._centerP.getCenter(),e.coordinate]),this._distP.setCoordinates(this._distance.getLastCoordinate())},c);function c(e){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var t=this,e=i.call(this,e);if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}r.mergeOptions({radiusDefault:1e3}),e.IdentifyTool=r,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.maptool.identifytool v0.1.0-alpha.1, requires maptalks@>=1.0.0-rc.1.")});